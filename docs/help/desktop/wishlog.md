# 祈愿记录

::: tip 提示
此功能在现阶段有很严重的性能问题，界面卡死是正常现象。
:::

## 云备份

寻空提供祈愿记录的云备份功能，**但是不能保证服务的可靠性**。

云备份功能使用 **从您本地原神日志中找到的祈愿记录网址** 验证账号所有权，验证通过即视为您本人操作，可从服务器中 `下载`、`上传`、`删除` 相关 Uid 的祈愿记录。

服务器没有冗余备份，定期备份由阿里云提供。


## 导入与导出  <Badge text="0.1.7.0 后" vertical="middle" />

> 0.1.7.0 版本及以后支持 [UIGF v2.2](../../archive/UIGF-v2.2.md)，功能位于 **工具箱 > 祈愿记录管理** 。

### 导入

::: tip 提示
由于依赖库的限制，导入功能不完全支持 [UIGF v2.2](../../archive/UIGF-v2.2.md) 。
:::

#### Excel 文件

导入的 Excel 文件中需含有名为 `原始数据` 的工作表，表的内容如下：

| 列名       | 备注                        |
| ---------- | --------------------------- |
| gacha_type | 祈愿类型，`200`、`301`……    |
| id         | 祈愿记录 id                 |
| item_type  | 物品类型，`角色`、`武器`    |
| lang       | 语言，`zh-cn`、`en-us`……    |
| name       | 物品名称                    |
| rank_type  | 物品等级                    |
| time       | 时间，`2022-04-11 09:52:04` |
| uid        | 账号 uid                    |

上述所有列名**必须**存在，除了 `lang` 和 `uid` 外，其他列**必须**有值，列的顺序没有要求。

#### Json 文件

寻空会遍历 Json 文件的每个元素，但只有以下格式的对象才会被解析：

``` json
{
    "uid": "123456789",             // 非必需
    "gacha_type": "100",            // 必需
    "time": "2021-02-14 21:50:21",  // 必需
    "name": "神射手之誓",            // 必需
    "lang": "zh-cn",                // 非必需，但不得为 null
    "item_type": "武器",            // 必需
    "rank_type": "3",               // 必需
    "id": "1613307960000763747"     // 必需
}
```

#### 数据补全

对于 [UIGF v2.2](../../archive/UIGF-v2.2.md) 中定义为非必需，但是在寻空中必需的字段，导入过程中提供数据补全功能，但是导入时填入的补全值不得与导入文件中的已有值冲突。

例如，导入文件中的 `uid` 有值 `0`、`123456789`，此时指定uid 可以填写 `123456789`，**不得**填写其他值如 `987654321`。

每次导入仅支持单文件单账号，如果文件内有多个账号的数据则会报错。

导入前会自动备份数据库内该 uid 的所有记录。


::: warning 警告
[UIGF v2.2](../../archive/UIGF-v2.2.md) 中定义 `time` 为非必需，但是寻空不支持没有 `time` 的数据导入。
:::

![祈愿记录导入功能](./img/image-20220411105929800.webp)

### 导出

导出功能支持 [UIGF v2.2](../../archive/UIGF-v2.2.md) 的全部值，文件路径为

`我的文档\Xunkong\Export\Wishlog\Wishlog_uid_yyyyMMdd_HHmmss.(json/xlsx)`


## 导入 <Badge text="0.1.7.0 前" type="warning" vertical="middle" />

> 0.1.7.0 版本之前仅支持导入功能，功能位于祈愿记录页面右上角

<details>

支持从 Excel 文件或 Json 文件导入祈愿记录，每次只能导入一个账号的数据，导入文件的格式要求如下：

### Excel 文件

导入的 Excel 文件需要包含名为`原始数据`的工作表，该表的内容符合以下格式（列顺序不做要求）：

| uid       | gacha_type | id                  | item_type | lang  | name       | rank_type | time                 |
| --------- | ---------- | ------------------- | --------- | ----- | ---------- | --------- | -------------------- |
| 123456789 | 100        | 1613307960000763747 | 武器      | zh-cn | 神射手之誓 | 3         | 2021-02-14  21:50:21 |

::: warning 警告
以上格式中的每一列**必须**存在，每一列**必须**要有值。
:::

### Json 文件

寻空会遍历 Json 文件的每个元素，但只有以下格式的对象才会被解析：

``` json
{
    "uid": "123456789",
    "gacha_type": "100",
    "time": "2021-02-14 21:50:21",
    "name": "神射手之誓",
    "lang": "zh-cn",
    "item_type": "武器",
    "rank_type": "3",
    "id": "1613307960000763747"
}
```

::: warning 警告
同样地，上述对象的每个字段**必须**存在，每个字段**必须**要有值，不得为`null`或`""`。
:::

### 导入过程中的常见错误

#### Imported wishlogs have items without uid

Json 文件中没有 `uid` 字段或 `uid` 字段为 `"0"`。

#### Please check sheetName/Index is correct

Excel 文件的工作表格式与上述要求不相符，请仔细检查每一列。

#### DbUpdateException

一般情况下是因为 Json 文件中的某些字段的值为 `null`，需修改为相应的正确值。

若仍出现此问题，请去 [提 Issue](https://github.com/Scighost/Xunkong/issues) 并附上相关日志。

</details>
